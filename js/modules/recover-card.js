import{changesTitle,formatNumber}from"./util.js";const recoverTemplate=document.querySelector("#recover").content.querySelector(".card__recover"),getItemPrice=e=>e.value*e.dataset.oldPrice,restoresCard=()=>{const e=document.querySelector(".products__list"),t=Array.from(e.children);if(t){let e=0,r=0,a=document.querySelector("#products-count"),c=document.querySelector("#products-price");t.forEach((t=>{const o=recoverTemplate.cloneNode(!0);let d=o.querySelector("#card-name"),s=t.querySelector(".card__title"),u=t.querySelector(".card__delete"),i=t.querySelector(".card__content"),l=o.querySelector(".card__recover-button"),m=o.querySelector(".card__recover-delete"),n=t.querySelector(".card__result-quantity-value"),p=document.querySelector("#total-price-items"),b=document.querySelector("#price-stocks"),N=document.querySelector("#price-discounts"),y=document.querySelector("#price-promo"),v=document.querySelector("#total-price"),S=document.querySelector("#price-delivery");u&&u.addEventListener("click",(()=>{t.removeChild(i),p.dataset.total=Number(p.dataset.total)-Number(n.dataset.totalPriceOld),p.textContent=formatNumber(p.dataset.total),b.dataset.priceStocks=Number(b.dataset.priceStocks)-(Number(n.dataset.totalPriceOld)-Number(n.dataset.totalPrice)),b.textContent=formatNumber(b.dataset.priceStocks),N.dataset.priceDiscounts=Number(b.dataset.priceStocks)+Number(y.dataset.pricePromo),N.textContent=formatNumber(N.dataset.priceDiscounts),v.dataset.priceTotalAll=Number(p.dataset.total)+Number(S.dataset.priceDelivery)-Number(N.dataset.priceDiscounts),v.textContent=formatNumber(v.dataset.priceTotalAll),a.dataset.count=Number(a.dataset.count)-Number(n.value),c.dataset.productsPrice=Number(c.dataset.productsPrice)-Number(n.dataset.totalPriceOld),changesTitle(a.dataset.count,c.dataset.productsPrice),"0"===a.dataset.count?(S.dataset.priceDelivery="0",S.textContent=formatNumber(S.dataset.priceDelivery)):(S.dataset.priceDelivery="200",S.textContent=formatNumber(S.dataset.priceDelivery)),d.textContent=d?s.textContent:"Наименование товара",t.appendChild(o)})),l&&l.addEventListener("click",(()=>{t.appendChild(i),t.removeChild(o),b.dataset.priceStocks=Number(b.dataset.priceStocks)+(Number(n.dataset.totalPriceOld)-Number(n.dataset.totalPrice)),b.textContent=formatNumber(b.dataset.priceStocks),N.dataset.priceDiscounts=Number(b.dataset.priceStocks)+Number(y.dataset.pricePromo),N.textContent=formatNumber(N.dataset.priceDiscounts),p.dataset.total=Number(p.dataset.total)+Number(n.dataset.totalPriceOld),p.textContent=formatNumber(p.dataset.total),v.dataset.priceTotalAll=Number(p.dataset.total)+Number(S.dataset.priceDelivery)-Number(N.dataset.priceDiscounts),v.textContent=formatNumber(v.dataset.priceTotalAll),a.dataset.count=Number(a.dataset.count)+Number(n.value),c.dataset.productsPrice=Number(c.dataset.productsPrice)+Number(n.dataset.totalPriceOld),changesTitle(a.dataset.count,c.dataset.productsPrice),"0"===a.dataset.count?(S.dataset.priceDelivery="0",S.textContent=formatNumber(S.dataset.priceDelivery)):(S.dataset.priceDelivery="200",S.textContent=formatNumber(S.dataset.priceDelivery))})),m&&m.addEventListener("click",(()=>{t.remove()})),e+=getItemPrice(n),r+=Number(n.value)})),a.dataset.count=r,c.dataset.productsPrice=e,changesTitle(a.dataset.count,c.dataset.productsPrice)}};export{restoresCard};